# üëÆ‚Äç‚ôÇÔ∏è MANUAL DO SISTEMA INTEGRADO (BOPE BOT)

Este bot gerencia **Recrutamento, Registro (Whitelist), Bate-Ponto Autom√°tico (Voz), Gest√£o de Horas, RH (Puni√ß√µes/Promo√ß√µes) e Tickets**.

## üõ†Ô∏è 1. PR√â-REQUISITOS

### A. Discord Developer Portal

1. Crie o Bot.
2. Em **Bot**, ative os **3 Privileged Gateway Intents** (Presence, Server Members, Message Content).
3. Convide o bot com permiss√£o de `Administrator`.
4. **IMPORTANTE:** Coloque o cargo do Bot **acima** de todos os cargos que ele precisa gerenciar (patentes, staff, etc.).

### B. Supabase (Banco de Dados)

1. Crie um projeto em [supabase.com](https://supabase.com).
2. V√° em **SQL Editor** e rode o c√≥digo abaixo para criar as tabelas:

```sql
-- 1. Tabela de Usu√°rios (Registro + Ranking)
create table usuarios_registrados (
  id bigint generated by default as identity primary key,
  discord_id text not null,
  nome_jogo text,
  id_jogo text,
  login_jogo text,
  horas_totais int default 0,
  data_registro timestamptz default now()
);

-- 2. Tabela de Controle de Ponto (Hist√≥rico)
create table controle_ponto (
  id bigint generated by default as identity primary key,
  discord_id text not null,
  entrada timestamptz default now(),
  saida timestamptz,
  tempo_minutos int,
  canal_id text,
  message_id text
);

```

---

## üìÇ 2. ESTRUTURA DO PROJETO

Crie uma pasta e organize os arquivos assim:

```text
MEU-BOT/
‚îú‚îÄ‚îÄ .env                  (Suas senhas - N√ÉO SUBIR PRO GITHUB)
‚îú‚îÄ‚îÄ .gitignore            (Configura√ß√£o do Git)
‚îú‚îÄ‚îÄ discloud.config       (Configura√ß√£o da Hospedagem)
‚îú‚îÄ‚îÄ index.js              (Arquivo Principal)
‚îú‚îÄ‚îÄ package.json          (Gerado automaticamente)
‚îú‚îÄ‚îÄ assets/               (Pasta de Imagens)
‚îÇ   ‚îî‚îÄ‚îÄ 2.jpg             (Imagem do Banner do Ticket)
‚îú‚îÄ‚îÄ sistemas/             (Pasta dos Sistemas)
‚îÇ   ‚îú‚îÄ‚îÄ formulario.js     (Recrutamento)
‚îÇ   ‚îú‚îÄ‚îÄ registro.js       (Whitelist)
‚îÇ   ‚îú‚îÄ‚îÄ ponto.js          (Bate-ponto Voz)
‚îÇ   ‚îú‚îÄ‚îÄ gestao.js         (Painel de Horas/Ranking)
‚îÇ   ‚îú‚îÄ‚îÄ rh.js             (Puni√ß√µes e Promo√ß√µes)
‚îÇ   ‚îî‚îÄ‚îÄ ticket.js         (Atendimento)
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ supabase.js       (Conex√£o Banco)

```

### Instala√ß√£o

No terminal, dentro da pasta:

```bash
npm init -y
npm install discord.js dotenv @supabase/supabase-js

```

---

## üìù 3. ARQUIVOS DE CONFIGURA√á√ÉO

### üìÑ `.env`

```ini
DISCORD_TOKEN=SEU_TOKEN_DO_BOT_AQUI
SUPABASE_URL=SUA_URL_SUPABASE
SUPABASE_KEY=SUA_KEY_ANON_PUBLIC

```

### üìÑ `.gitignore`

```text
node_modules/
.env

```

### üìÑ `utils/supabase.js`

```javascript
require('dotenv').config();
const { createClient } = require('@supabase/supabase-js');
const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_KEY);
module.exports = supabase;

```

---

## ü§ñ 4. C√ìDIGO PRINCIPAL (`index.js`)

```javascript
require('dotenv').config();
const { Client, GatewayIntentBits } = require('discord.js');

const sysForm = require('./sistemas/formulario');
const sysReg = require('./sistemas/registro');
const sysPonto = require('./sistemas/ponto');
const sysGestao = require('./sistemas/gestao');
const sysRH = require('./sistemas/rh');
const sysTicket = require('./sistemas/ticket');

const client = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.MessageContent,
        GatewayIntentBits.GuildMembers,
        GatewayIntentBits.GuildVoiceStates
    ]
});

client.once('ready', async () => {
    console.log(`üíÄ SISTEMA ONLINE: ${client.user.tag}`);
    try {
        console.log("‚è≥ Carregando pain√©is...");
        await sysForm.enviarPainel(client);
        await sysReg.enviarPainel(client);
        await sysGestao.enviarPainel(client);
        await sysRH.enviarPainel(client);
        await sysTicket.enviarPainel(client);
        console.log("‚úÖ Tudo pronto!");
    } catch (error) { console.error("Erro:", error); }
});

client.on('interactionCreate', async (interaction) => {
    try {
        await sysForm.gerenciarFormulario(interaction, client);
        await sysReg.gerenciarRegistro(interaction, client);
        await sysGestao.gerenciarInteracoes(interaction);
        await sysRH.gerenciarRH(interaction, client);
        await sysTicket.gerenciarTicket(interaction, client);
    } catch (error) { console.error(error); }
});

client.on('voiceStateUpdate', async (oldState, newState) => {
    await sysPonto.gerenciarPonto(oldState, newState, client);
});

client.login(process.env.DISCORD_TOKEN);

```

---

## üëÆ 5. SISTEMAS (PASTA `sistemas/`)

### üìÑ `sistemas/registro.js`

*Configura√ß√£o:* Mude os IDs dos canais e do cargo de marca√ß√£o.

```javascript
const { EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle, ModalBuilder, TextInputBuilder, TextInputStyle, InteractionType } = require('discord.js');
const supabase = require('../utils/supabase');

// --- EDITAR AQUI ---
const ID_CANAL_REGISTRO = 'ID_DO_CANAL_BOTAO';
const ID_CANAL_LOG = 'ID_DO_CANAL_LOG';
const EMOJI_COP = 'üëÆ'; 
const ID_CARGO_MARCACAO = 'ID_CARGO_PARA_MARCAR';

async function enviarPainel(client) {
    const channel = await client.channels.fetch(ID_CANAL_REGISTRO).catch(() => null);
    if (!channel) return;
    const msgs = await channel.messages.fetch({ limit: 5 });
    if (msgs.size > 0) await channel.bulkDelete(msgs).catch(()=>{});

    const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('abrir_registro').setLabel('Realizar Registro').setStyle(ButtonStyle.Primary).setEmoji('üìã'));
    await channel.send({ embeds: [new EmbedBuilder().setTitle('üìã Registro Oficial').setDescription('Clique abaixo para registrar.').setColor(0x0099FF)], components: [row] });
}

async function gerenciarRegistro(interaction, client) {
    if (interaction.isButton() && interaction.customId === 'abrir_registro') {
        const modal = new ModalBuilder().setCustomId('modal_reg').setTitle('Registro Policial');
        modal.addComponents(
            new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('nome').setLabel('Nickname').setStyle(TextInputStyle.Short).setRequired(true)),
            new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('id_jogo').setLabel('ID no Jogo').setStyle(TextInputStyle.Short).setRequired(true)),
            new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('login').setLabel('Login').setStyle(TextInputStyle.Short).setRequired(true))
        );
        await interaction.showModal(modal);
    }

    if (interaction.type === InteractionType.ModalSubmit && interaction.customId === 'modal_reg') {
        await interaction.deferReply({ ephemeral: true });
        const nome = interaction.fields.getTextInputValue('nome');
        const idJogo = interaction.fields.getTextInputValue('id_jogo');
        const login = interaction.fields.getTextInputValue('login');

        const { data: existe } = await supabase.from('usuarios_registrados').select('*').eq('discord_id', interaction.user.id).single();
        if (existe) return interaction.editReply(`‚ö†Ô∏è J√° registrado como **${existe.nome_jogo}**.`);

        await supabase.from('usuarios_registrados').insert({ discord_id: interaction.user.id, nome_jogo: nome, id_jogo: idJogo, login_jogo: login });
        try { await interaction.member.setNickname(`${nome} | ${idJogo}`); } catch (e) {}

        const logChannel = await client.channels.fetch(ID_CANAL_LOG);
        if (logChannel) logChannel.send(`${EMOJI_COP} **NOME:** <@${interaction.user.id}>\n${EMOJI_COP} **NICK:** ${nome}\n${EMOJI_COP} **LOGIN:** ${login}\n${EMOJI_COP} **ID:** ${idJogo}\n${EMOJI_COP} **MARCA√á√ÉO:** <@&${ID_CARGO_MARCACAO}>`);
        await interaction.editReply('‚úÖ Registro realizado!');
    }
}
module.exports = { enviarPainel, gerenciarRegistro };

```

### üìÑ `sistemas/formulario.js` (Recrutamento)

*Configura√ß√£o:* IDs de canais, categoria, cargo recrutador e cargos de aprova√ß√£o.

```javascript
const { EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle, ChannelType, PermissionsBitField } = require('discord.js');

// --- EDITAR AQUI ---
const ID_CANAL_BOTAO = 'ID_CANAL';
const ID_CANAL_RESPOSTAS = 'ID_CANAL'; // Onde admins veem
const ID_CATEGORIA = 'ID_CATEGORIA_TICKETS';
const ID_CANAL_RESULTADO = 'ID_CANAL_RESULTADO_PUBLICO';
const ID_CARGO_RECRUTADOR = 'ID_CARGO_ADMIN';
const IDS_CARGOS_APROVADO = ['ID_CARGO_1', 'ID_CARGO_2'];

// IDs dos canais de pr√≥ximos passos (aparecem quando aprovado)
const ID_CANAL_REGISTRO_REF = 'ID_CANAL_REGISTRO';
const ID_CANAL_TAG_REF = 'ID_CANAL_TAG';

const PERGUNTAS = ['1. Nome e Idade?', '2. ID no Jogo?', '3. Defina RP e Anti-RP.', '4. Por que quer entrar?'];

async function enviarPainel(client) {
    const channel = await client.channels.fetch(ID_CANAL_BOTAO).catch(() => null);
    if (!channel) return;
    const msgs = await channel.messages.fetch({ limit: 5 });
    if (msgs.size > 0) await channel.bulkDelete(msgs).catch(()=>{});
    const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('iniciar_form').setLabel('Iniciar Recrutamento').setStyle(ButtonStyle.Secondary).setEmoji('üíÄ'));
    await channel.send({ embeds: [new EmbedBuilder().setTitle('Recrutamento').setDescription('Clique para iniciar.').setColor(0xFFD700)], components: [row] });
}

async function gerenciarFormulario(interaction, client) {
    const { customId, guild, user } = interaction;
    if (customId === 'iniciar_form') {
        await interaction.deferReply({ ephemeral: true });
        const channel = await guild.channels.create({
            name: `rec-${user.username.replace(/[^a-z0-9]/gi,'').substring(0,10)}`, type: ChannelType.GuildText, parent: ID_CATEGORIA,
            permissionOverwrites: [{id: guild.id, deny:[PermissionsBitField.Flags.ViewChannel]}, {id: user.id, allow:[PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages]}, {id: client.user.id, allow:[PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages]}]
        });
        await interaction.editReply(`Ticket criado: ${channel}`);
        const respostas = [];
        for (const p of PERGUNTAS) {
            await channel.send({ embeds: [new EmbedBuilder().setDescription(`**${p}**`).setColor(0xFFD700)] });
            const collected = await channel.awaitMessages({ filter: m => m.author.id === user.id, max: 1, time: 300000 }).catch(() => null);
            if (!collected || !collected.first()) return setTimeout(() => channel.delete().catch(()=>{}), 5000);
            respostas.push({ pergunta: p, resposta: collected.first().content });
        }
        await channel.send('‚úÖ Enviado. Fechando em 5s.');
        setTimeout(() => channel.delete().catch(()=>{}), 5000);
        
        const canalResp = await client.channels.fetch(ID_CANAL_RESPOSTAS);
        const embed = new EmbedBuilder().setTitle(`Candidato: ${user.tag}`).setThumbnail(user.displayAvatarURL()).setColor(0xFFFF00);
        respostas.forEach(r => embed.addFields({ name: r.pergunta, value: r.resposta.substring(0, 1000) }));
        const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId(`apv_${user.id}`).setLabel('Aprovar').setStyle(ButtonStyle.Success), new ButtonBuilder().setCustomId(`rep_${user.id}`).setLabel('Reprovar').setStyle(ButtonStyle.Danger));
        await canalResp.send({ embeds: [embed], components: [row] });
    }

    if (customId.startsWith('apv_') || customId.startsWith('rep_')) {
        await interaction.deferUpdate();
        if (!interaction.member.roles.cache.has(ID_CARGO_RECRUTADOR)) return;
        const targetId = customId.split('_')[1];
        const isApproved = customId.startsWith('apv');
        const member = await guild.members.fetch(targetId).catch(() => null);
        const canalRes = await client.channels.fetch(ID_CANAL_RESULTADO);

        if (member && isApproved) await member.roles.add(IDS_CARGOS_APROVADO).catch(()=>{});
        if (member) member.send(isApproved ? `üéâ Aprovado!` : `‚ùå Reprovado.`).catch(()=>{});

        if (canalRes) {
            const embedPub = new EmbedBuilder().setTitle(isApproved ? '‚úÖ Candidato Aprovado' : '‚ùå Candidato Reprovado').setColor(isApproved ? 0x57F287 : 0xED4245).setThumbnail(member ? member.user.displayAvatarURL() : null).setTimestamp().setFooter({text: guild.name, iconURL: guild.iconURL()});
            let desc = `O formul√°rio de **${member?member.user.username:'Desc.'}** (<@${targetId}>) foi processado.`;
            if (isApproved) desc += `\n\n**PR√ìXIMOS PASSOS:**\n1. Registre-se: <#${ID_CANAL_REGISTRO_REF}>\n2. Pegue a tag: <#${ID_CANAL_TAG_REF}>`;
            else desc += `\n\n**ORIENTA√á√ÉO:** Leia as regras.`;
            embedPub.setDescription(desc);
            embedPub.addFields({ name: 'Status', value: isApproved?'Aprovado':'Reprovado', inline: true }, { name: 'Recrutador', value: `${user}`, inline: true });
            await canalRes.send({ embeds: [embedPub] });
        }
        const newEmbed = EmbedBuilder.from(interaction.message.embeds[0]).setTitle(isApproved ? '‚úÖ APROVADO' : '‚ùå REPROVADO').setColor(isApproved ? 0x00FF00 : 0xFF0000).setFooter({ text: `Avaliado por: ${user.tag}` });
        await interaction.editReply({ components: [], embeds: [newEmbed] });
    }
}
module.exports = { enviarPainel, gerenciarFormulario };

```

### üìÑ `sistemas/ponto.js` (Bate-Ponto)

*Configura√ß√£o:* Categoria onde conta o tempo e canal de logs.

```javascript
const { EmbedBuilder } = require('discord.js');
const supabase = require('../utils/supabase');

// --- EDITAR AQUI ---
const ID_CANAL_LOG_PONTO = 'ID_CANAL_LOG';
const ID_CATEGORIA_PERMITIDA = 'ID_CATEGORIA_CALLS';

async function gerenciarPonto(oldState, newState, client) {
    const user = newState.member ? newState.member.user : oldState.member.user;
    if (user.bot) return;

    const oldCat = oldState.channel ? oldState.channel.parentId : null;
    const newCat = newState.channel ? newState.channel.parentId : null;

    if (newCat === ID_CATEGORIA_PERMITIDA && oldCat !== ID_CATEGORIA_PERMITIDA) {
        const channelLog = await client.channels.fetch(ID_CANAL_LOG_PONTO).catch(() => null);
        let msgId = null;
        if (channelLog) {
            const embed = new EmbedBuilder().setAuthor({ name: user.tag, iconURL: user.displayAvatarURL() }).setDescription(`üü¢ **INICIOU PATRULHA**\nüìç ${newState.channel.name}\n‚è∞ <t:${Math.floor(Date.now()/1000)}:R>`).setColor(0x57F287);
            const msg = await channelLog.send({ embeds: [embed] });
            msgId = msg.id;
        }
        await supabase.from('controle_ponto').insert({ discord_id: user.id, canal_id: newState.channel.id, entrada: new Date().toISOString(), message_id: msgId });
    }
    else if (oldCat === ID_CATEGORIA_PERMITIDA && newCat !== ID_CATEGORIA_PERMITIDA) {
        const { data: ponto } = await supabase.from('controle_ponto').select('*').eq('discord_id', user.id).is('saida', null).single();
        if (ponto) {
            const dataEntrada = new Date(ponto.entrada);
            const dataSaida = new Date();
            const minutos = Math.floor((dataSaida - dataEntrada) / 1000 / 60);
            await supabase.from('controle_ponto').update({ saida: dataSaida.toISOString(), tempo_minutos: minutos }).eq('id', ponto.id);
            
            const { data: userReg } = await supabase.from('usuarios_registrados').select('horas_totais').eq('discord_id', user.id).single();
            if (userReg) await supabase.from('usuarios_registrados').update({ horas_totais: (userReg.horas_totais || 0) + minutos }).eq('discord_id', user.id);

            if (ponto.message_id) {
                const channelLog = await client.channels.fetch(ID_CANAL_LOG_PONTO);
                const msgAntiga = await channelLog.messages.fetch(ponto.message_id).catch(() => null);
                if (msgAntiga) {
                    const horas = Math.floor(minutos / 60); const mins = minutos % 60;
                    const embedEdit = new EmbedBuilder().setAuthor({ name: user.tag, iconURL: user.displayAvatarURL() }).setTitle('‚úÖ PATRULHA FINALIZADA').addFields({name: 'Entrada', value:`<t:${Math.floor(dataEntrada.getTime()/1000)}:t>`, inline:true}, {name: 'Sa√≠da', value:`<t:${Math.floor(dataSaida.getTime()/1000)}:t>`, inline:true}, {name: 'Tempo Total', value:`**${horas}h ${mins}m**`, inline:true}).setColor(0xED4245);
                    await msgAntiga.edit({ embeds: [embedEdit] });
                }
            }
        }
    }
}
module.exports = { gerenciarPonto };

```

### üìÑ `sistemas/gestao.js` (Painel Horas)

*Configura√ß√£o:* Canal do painel e cargo comandante.

```javascript
const { EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle, ModalBuilder, TextInputBuilder, TextInputStyle } = require('discord.js');
const supabase = require('../utils/supabase');

// --- EDITAR AQUI ---
const ID_CANAL_PAINEL = 'ID_CANAL';
const ID_CARGO_PERMITIDO = 'ID_CARGO_COMANDANTE';

async function enviarPainel(client) {
    const channel = await client.channels.fetch(ID_CANAL_PAINEL).catch(() => null);
    if (!channel) return;
    const msgs = await channel.messages.fetch({ limit: 5 });
    if (msgs.size > 0) await channel.bulkDelete(msgs).catch(()=>{});
    const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('ver_ranking').setLabel('Ranking').setStyle(ButtonStyle.Primary).setEmoji('üèÜ'), new ButtonBuilder().setCustomId('ajustar_horas').setLabel('Ajustar').setStyle(ButtonStyle.Secondary).setEmoji('‚úèÔ∏è'), new ButtonBuilder().setCustomId('resetar_tudo').setLabel('Resetar').setStyle(ButtonStyle.Danger).setEmoji('üóëÔ∏è'));
    await channel.send({ embeds: [new EmbedBuilder().setTitle('üëÆ‚Äç‚ôÇÔ∏è Controle de Ponto').setDescription('Gerencie as horas aqui.').setColor(0x2B2D31)], components: [row] });
}

async function gerenciarInteracoes(interaction) {
    if (!interaction.isButton() && !interaction.isModalSubmit()) return;
    if (['ver_ranking', 'ajustar_horas', 'resetar_tudo', 'modal_ajuste', 'confirm_reset'].includes(interaction.customId)) {
         if (!interaction.member.roles.cache.has(ID_CARGO_PERMITIDO)) return interaction.reply({ content: '‚õî Sem permiss√£o.', ephemeral: true });
    }

    if (interaction.customId === 'ver_ranking') {
        await interaction.deferReply({ ephemeral: true });
        const { data: ranking } = await supabase.from('usuarios_registrados').select('discord_id, horas_totais, data_registro').order('horas_totais', { ascending: false });
        if (!ranking || ranking.length === 0) return interaction.editReply("Vazio.");
        const TAMANHO_PAGINA = 30; const totalPaginas = Math.ceil(ranking.length / TAMANHO_PAGINA);
        for (let i = 0; i < totalPaginas; i++) {
            const lote = ranking.slice(i * TAMANHO_PAGINA, (i + 1) * TAMANHO_PAGINA);
            let texto = "";
            lote.forEach((u, index) => {
                const h = Math.floor((u.horas_totais||0)/60); const m = (u.horas_totais||0)%60;
                let dataF = u.data_registro ? new Date(u.data_registro).toLocaleDateString('pt-BR') : 'N/A';
                texto += `**#${(i*30)+index+1}** <@${u.discord_id}> ‚Äî \`${h}h ${m}m\` (üìÖ ${dataF})\n`;
            });
            const embed = new EmbedBuilder().setTitle(`üèÜ Ranking Pg ${i+1}/${totalPaginas}`).setDescription(texto).setColor(0xFFD700);
            i === 0 ? await interaction.editReply({ embeds: [embed] }) : await interaction.followUp({ embeds: [embed], ephemeral: true });
        }
    }

    if (interaction.customId === 'ajustar_horas') {
        const modal = new ModalBuilder().setCustomId('modal_ajuste').setTitle('Ajuste Manual');
        modal.addComponents(new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('id_discord').setLabel('ID Discord').setStyle(TextInputStyle.Short).setRequired(true)), new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('minutos').setLabel('Minutos (+/-)').setStyle(TextInputStyle.Short).setRequired(true)));
        await interaction.showModal(modal);
    }
    if (interaction.customId === 'modal_ajuste') {
        await interaction.deferReply({ ephemeral: true });
        const target = interaction.fields.getTextInputValue('id_discord');
        const mins = parseInt(interaction.fields.getTextInputValue('minutos'));
        const { data: user } = await supabase.from('usuarios_registrados').select('horas_totais').eq('discord_id', target).single();
        if (!user) return interaction.editReply('‚ùå N√£o encontrado.');
        const novas = Math.max(0, (user.horas_totais || 0) + mins);
        await supabase.from('usuarios_registrados').update({ horas_totais: novas }).eq('discord_id', target);
        await interaction.editReply(`‚úÖ Atualizado.`);
    }
    if (interaction.customId === 'resetar_tudo') await interaction.reply({ content: '‚ö†Ô∏è Resetar TUDO?', components: [new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('confirm_reset').setLabel('CONFIRMAR').setStyle(ButtonStyle.Danger))], ephemeral: true });
    if (interaction.customId === 'confirm_reset') {
        await interaction.deferUpdate();
        await supabase.from('usuarios_registrados').update({ horas_totais: 0 }).neq('discord_id', '0');
        await interaction.editReply({ content: 'üí• Resetado.', components: [] });
    }
}
module.exports = { enviarPainel, gerenciarInteracoes };

```

### üìÑ `sistemas/rh.js` (Puni√ß√µes e Promo√ß√µes)

*Configura√ß√£o:* Preencha a lista de Patentes e os IDs dos canais de log.

```javascript
const { ActionRowBuilder, ButtonBuilder, ButtonStyle, StringSelectMenuBuilder, UserSelectMenuBuilder, ModalBuilder, TextInputBuilder, TextInputStyle, InteractionType, EmbedBuilder } = require('discord.js');

// --- EDITAR AQUI ---
const ID_CANAL_PAINEL = 'ID_CANAL';
const ID_LOG_ADV = 'ID_LOG_ADV';
const ID_LOG_EXONERACAO = 'ID_LOG_EXON';
const ID_LOG_PROMOCAO = 'ID_LOG_UP';
const ID_LOG_REBAIXAMENTO = 'ID_LOG_DOWN';

const PATENTES_PARTE_1 = [
    { label: 'Coronel', value: 'ID_CARGO' },
    { label: 'Tenente', value: 'ID_CARGO' }
    // ... complete at√© 25 itens
];
const PATENTES_PARTE_2 = [
    { label: 'Cabo', value: 'ID_CARGO' }
    // ... restante
];
const ADVERTENCIAS = [
    { label: 'Advert√™ncia Verbal', value: 'ID_CARGO' },
    { label: 'Advert√™ncia Grave', value: 'ID_CARGO' }
];

const ID_CARGO_EXONERADO = 'ID_CARGO_EXONERADO';
const ID_CARGO_MANTER = 'ID_CARGO_CIDADAO'; // Cargo que sobra
const TODAS_PATENTES_IDS = [...PATENTES_PARTE_1, ...PATENTES_PARTE_2].map(p => p.value);

async function enviarPainel(client) {
    const channel = await client.channels.fetch(ID_CANAL_PAINEL).catch(() => null);
    if (!channel) return;
    const msgs = await channel.messages.fetch({ limit: 5 });
    if (msgs.size > 0) await channel.bulkDelete(msgs).catch(()=>{});
    const embed = new EmbedBuilder().setTitle('PAINEL DE RH').setDescription('Gerencie membros.').setColor(0x2B2D31);
    const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('rh_btn_promover').setLabel('Promover').setStyle(ButtonStyle.Success), new ButtonBuilder().setCustomId('rh_btn_rebaixar').setLabel('Rebaixar').setStyle(ButtonStyle.Secondary), new ButtonBuilder().setCustomId('rh_btn_advertir').setLabel('Advert√™ncia').setStyle(ButtonStyle.Primary), new ButtonBuilder().setCustomId('rh_btn_exonerar').setLabel('Exonerar').setStyle(ButtonStyle.Danger));
    await channel.send({ embeds: [embed], components: [row] });
}

async function gerenciarRH(interaction, client) {
    if (interaction.isButton() && interaction.customId.startsWith('rh_btn_')) {
        const acao = interaction.customId.replace('rh_btn_', '');
        const row = new ActionRowBuilder().addComponents(new UserSelectMenuBuilder().setCustomId(`rh_user_select_${acao}`).setPlaceholder('Selecione o membro...').setMaxValues(1));
        await interaction.reply({ content: `**A√á√ÉO:** ${acao.toUpperCase()}`, components: [row], ephemeral: true });
    }

    if (interaction.isUserSelectMenu() && interaction.customId.startsWith('rh_user_select_')) {
        const acao = interaction.customId.replace('rh_user_select_', '');
        const targetId = interaction.values[0];
        
        if (acao === 'exonerar') {
            const modal = new ModalBuilder().setCustomId(`rh_modal_exon_${targetId}`).setTitle('Motivo');
            modal.addComponents(new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('motivo').setLabel('Motivo').setStyle(TextInputStyle.Paragraph).setRequired(true)));
            await interaction.showModal(modal);
            return;
        }
        if (acao === 'advertir') {
            const rowAdv = new ActionRowBuilder().addComponents(new StringSelectMenuBuilder().setCustomId(`rh_pre_advertir_${targetId}`).setPlaceholder('N√≠vel da Advert√™ncia').addOptions(ADVERTENCIAS));
            await interaction.update({ content: `**ADVERTIR** <@${targetId}>`, components: [rowAdv] });
            return;
        }
        if (acao === 'promover' || acao === 'rebaixar') {
            const row1 = new ActionRowBuilder().addComponents(new StringSelectMenuBuilder().setCustomId(`rh_final_${acao}_${targetId}_p1`).setPlaceholder('Patentes Altas').addOptions(PATENTES_PARTE_1));
            const row2 = new ActionRowBuilder().addComponents(new StringSelectMenuBuilder().setCustomId(`rh_final_${acao}_${targetId}_p2`).setPlaceholder('Patentes Baixas').addOptions(PATENTES_PARTE_2));
            await interaction.update({ content: `**${acao.toUpperCase()}** <@${targetId}>`, components: [row1, row2] });
        }
    }

    if (interaction.isStringSelectMenu() && interaction.customId.startsWith('rh_pre_advertir_')) {
        const targetId = interaction.customId.split('_')[3];
        const roleId = interaction.values[0];
        const modal = new ModalBuilder().setCustomId(`rh_modal_adv_${targetId}_${roleId}`).setTitle('Detalhes');
        modal.addComponents(new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('motivo').setLabel('Motivo').setStyle(TextInputStyle.Paragraph).setRequired(true)), new ActionRowBuilder().addComponents(new TextInputBuilder().setCustomId('tempo').setLabel('Tempo').setStyle(TextInputStyle.Short).setRequired(true)));
        await interaction.showModal(modal);
    }

    if (interaction.type === InteractionType.ModalSubmit) {
        if (interaction.customId.startsWith('rh_modal_adv_')) {
            await interaction.deferReply({ ephemeral: true });
            const [_, __, ___, targetId, roleId] = interaction.customId.split('_');
            const motivo = interaction.fields.getTextInputValue('motivo');
            const tempo = interaction.fields.getTextInputValue('tempo');
            const member = await interaction.guild.members.fetch(targetId).catch(() => null);
            if (member) await member.roles.add(roleId).catch(()=>{});
            const log = await client.channels.fetch(ID_LOG_ADV);
            if (log) log.send(`**RELATORIO DE ADVERTENCIA**\n\n**Membro:** <@${targetId}>\n**Aplicado por:** <@${interaction.user.id}>\n**Tipo:** <@&${roleId}>\n**Motivo:** ${motivo}\n**Tempo:** ${tempo}`);
            await interaction.editReply('‚úÖ Advertido.');
        }
        if (interaction.customId.startsWith('rh_modal_exon_')) {
            await interaction.deferReply({ ephemeral: true });
            const targetId = interaction.customId.split('_')[3];
            const motivo = interaction.fields.getTextInputValue('motivo');
            const member = await interaction.guild.members.fetch(targetId).catch(() => null);
            if (member) {
                try { await member.roles.set([ID_CARGO_MANTER, ID_CARGO_EXONERADO]); } catch(e){}
            }
            const log = await client.channels.fetch(ID_LOG_EXONERACAO);
            if (log) log.send(`**RELATORIO DE EXONERACAO**\n\n**Exonerado:** <@${targetId}>\n**Responsavel:** <@${interaction.user.id}>\n**Motivo:** ${motivo}`);
            await interaction.editReply('üö´ Exonerado.');
        }
    }

    if (interaction.isStringSelectMenu() && interaction.customId.startsWith('rh_final_')) {
        await interaction.deferUpdate();
        const parts = interaction.customId.split('_');
        const acao = parts[2]; const targetId = parts[3]; const roleId = interaction.values[0];
        const member = await interaction.guild.members.fetch(targetId).catch(() => null);
        if (member) {
            const rolesToRemove = member.roles.cache.filter(r => TODAS_PATENTES_IDS.includes(r.id));
            if (rolesToRemove.size > 0) await member.roles.remove(rolesToRemove).catch(() => {});
            await member.roles.add(roleId).catch(()=>{});
        }
        const log = await client.channels.fetch(acao === 'promover' ? ID_LOG_PROMOCAO : ID_LOG_REBAIXAMENTO);
        if (log) log.send(`**RELATORIO DE ${acao.toUpperCase()}**\n\n**Membro:** <@${targetId}>\n**Responsavel:** <@${interaction.user.id}>\n**Novo Cargo:** <@&${roleId}>`);
        await interaction.editReply({ content: '‚úÖ Feito.', components: [] });
    }
}
module.exports = { enviarPainel, gerenciarRH };

```

### üìÑ `sistemas/ticket.js` (Atendimento com Imagem)

*Configura√ß√£o:* Crie a pasta `assets` e coloque a imagem `2.jpg`. Edite os IDs.

```javascript
const { EmbedBuilder, ActionRowBuilder, StringSelectMenuBuilder, ChannelType, PermissionsBitField, ButtonBuilder, ButtonStyle, AttachmentBuilder } = require('discord.js');
const path = require('path');
const fs = require('fs');

// --- EDITAR AQUI ---
const ID_CANAL_PAINEL = 'ID_CANAL';
const ID_CATEGORIA_TICKET = 'ID_CATEGORIA';
const ID_CARGO_STAFF = 'ID_CARGO_STAFF_ESPECIAL'; // S√≥ esse cargo v√™

const CAMINHO_IMAGEM = path.join(__dirname, '../assets/2.jpg');

async function enviarPainel(client) {
    const channel = await client.channels.fetch(ID_CANAL_PAINEL).catch(() => null);
    if (!channel) return;
    const msgs = await channel.messages.fetch({ limit: 5 });
    if (msgs.size > 0) await channel.bulkDelete(msgs).catch(() => {});
    const banner = fs.existsSync(CAMINHO_IMAGEM) ? new AttachmentBuilder(CAMINHO_IMAGEM, { name: 'banner.jpg' }) : null;
    const embed = new EmbedBuilder().setTitle('üéüÔ∏è | TICKET').setDescription('Selecione uma categoria abaixo.').setColor(0x2B2D31).setFooter({ text: 'Atendimento', iconURL: client.user.displayAvatarURL() });
    if (banner) embed.setImage('attachment://banner.jpg');
    const row = new ActionRowBuilder().addComponents(new StringSelectMenuBuilder().setCustomId('ticket_menu_abrir').setPlaceholder('Selecione a categoria').addOptions([{ label: 'D√∫vidas', value: 'duvida', emoji: '‚ùî' }, { label: 'Den√∫ncias', value: 'denuncia', emoji: 'üì§' }, { label: 'Revis√£o', value: 'revisao', emoji: '‚öñÔ∏è' }]));
    const payload = { embeds: [embed], components: [row] };
    if (banner) payload.files = [banner];
    await channel.send(payload);
}

async function gerenciarTicket(interaction, client) {
    if (interaction.isStringSelectMenu() && interaction.customId === 'ticket_menu_abrir') {
        await interaction.deferReply({ ephemeral: true });
        const user = interaction.user;
        const exists = interaction.guild.channels.cache.find(c => c.name === `ticket-${user.username.replace(/[^a-z0-9]/g, '')}`);
        if (exists) return interaction.editReply(`‚ùå Voc√™ j√° tem um ticket: ${exists}`);
        
        let titulo = 'Atendimento';
        if (interaction.values[0] === 'duvida') titulo = 'D√∫vidas';
        if (interaction.values[0] === 'denuncia') titulo = 'Den√∫ncia';
        if (interaction.values[0] === 'revisao') titulo = 'Revis√£o';

        const canal = await interaction.guild.channels.create({
            name: `ticket-${user.username}`, type: ChannelType.GuildText, parent: ID_CATEGORIA_TICKET, topic: `${titulo} - ${user.tag}`,
            permissionOverwrites: [{id: interaction.guild.id, deny: [PermissionsBitField.Flags.ViewChannel]}, {id: user.id, allow: [PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages]}, {id: ID_CARGO_STAFF, allow: [PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages]}, {id: client.user.id, allow: [PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages]}]
        });
        const embed = new EmbedBuilder().setTitle(`üéüÔ∏è ${titulo}`).setDescription(`Ol√° <@${user.id}>! A equipe <@&${ID_CARGO_STAFF}> ir√° te atender.`).setColor(0x57F287);
        const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('ticket_btn_fechar').setLabel('Fechar Ticket').setStyle(ButtonStyle.Danger).setEmoji('üîí'));
        await canal.send({ content: `<@${user.id}> | <@&${ID_CARGO_STAFF}>`, embeds: [embed], components: [row] });
        await interaction.editReply(`‚úÖ Ticket criado: ${canal}`);
    }
    if (interaction.isButton() && interaction.customId === 'ticket_btn_fechar') {
        await interaction.reply('üîí Fechando em 5s...');
        setTimeout(() => interaction.channel.delete().catch(() => {}), 5000);
    }
}
module.exports = { enviarPainel, gerenciarTicket };

```